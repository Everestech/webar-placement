<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Detección de Marcador AR.js</title>
    
    <!-- Tailwind CSS CDN para estilo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <!-- 1. A-Frame para la escena 3D -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    
    <!-- 2. AR.js (A-Frame component) para la detección de marcadores -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Inter', sans-serif; }
        /* Oculta la escena A-Frame hasta que esté lista */
        #ar-scene { visibility: hidden; }
        #message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            background-color: rgba(17, 24, 39, 0.9); /* Dark overlay */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        .instructions {
            background-color: #1f2937;
            color: #d1d5db;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            border: 1px solid #374151;
        }
    </style>
</head>
<body>

    <!-- Contenedor de la UI para el mensaje de inicio -->
    <div id="message-box" class="text-center">
        <h1 class="text-2xl font-bold text-white mb-4">Activación de Realidad Aumentada</h1>
        <p id="status-message" class="text-gray-300 mb-6">Presione 'Iniciar AR' para solicitar la cámara y comenzar la detección.</p>
        
        <!-- El botón para iniciar la secuencia de la cámara/AR -->
        <button id="startButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition duration-300 transform hover:scale-105 cursor-pointer">
            Iniciar AR
        </button>

        <div class="instructions mt-6">
            <p class="font-semibold text-lg mb-2 text-yellow-400">Instrucciones:</p>
            <p class="text-sm">Una vez que la cámara se active, apúntala al marcador 'hiro' (un cuadrado negro con el centro blanco) o a cualquier marcador de patrón.</p>
            <p class="text-sm mt-1">Busca el marcador 'hiro' en línea para probar la detección.</p>
        </div>
    </div>

    <!-- Escena A-Frame para Realidad Aumentada -->
    <a-scene id="ar-scene" embedded arjs='sourceType: webcam; detectionMode: mono; cameraParametersUrl: https://raw.githack.com/AR-js-org/AR.js/master/data/camera_para.dat;'>

        <!-- 3. Definición del marcador AR -->
        <!-- Este marcador usa el patrón predeterminado 'hiro'. Cuando se detecta, se muestra el contenido dentro. -->
        <a-marker preset='hiro'>
            <!-- Contenido que aparece sobre el marcador (Un cubo rojo) -->
            <a-box position='0 0.5 0' material='color: red; opacity: 0.8;'></a-box>
            <a-text value="¡Marcador Detectado!" position="0 1.2 0" align="center" width="2" color="#FFFFFF"></a-text>
        </a-marker>

        <!-- Cámara AR.js predeterminada -->
        <a-entity camera></a-entity>

    </a-scene>

    <script>
        const startButton = document.getElementById('startButton');
        const messageBox = document.getElementById('message-box');
        const statusMessage = document.getElementById('status-message');
        const arScene = document.getElementById('ar-scene');

        // Función que inicia AR.js después del gesto del usuario
        const initArJs = () => {
            statusMessage.textContent = "Cargando componentes de AR.js...";
            startButton.disabled = true;
            startButton.textContent = "Iniciando...";

            // 1. Mostrar la escena A-Frame (la cámara aparecerá automáticamente si AR.js funciona)
            arScene.style.visibility = 'visible';

            // 2. Esperar a que la cámara se inicialice (AR.js lo maneja internamente)
            arScene.addEventListener('loaded', function () {
                statusMessage.textContent = "Cámara activada. Buscando marcador 'hiro'...";
                
                // Ocultar la UI con una transición suave después de un breve retraso
                setTimeout(() => {
                    messageBox.style.transition = 'opacity 1s ease';
                    messageBox.style.opacity = '0';
                    setTimeout(() => { messageBox.style.display = 'none'; }, 1000);
                }, 2000); // Dar 2 segundos para que el usuario lea el mensaje
            });
            
            // Manejo de errores (Esto solo puede capturar errores de A-Frame/AR.js, no necesariamente de permisos)
            arScene.addEventListener('arjs-error', function (evt) {
                console.error("AR.js Error:", evt.detail);
                statusMessage.innerHTML = `<div class="bg-red-500 text-white p-2 rounded">Error grave de AR.js: ${evt.detail}</div>`;
                startButton.textContent = 'Error, recargar';
                startButton.disabled = false;
                startButton.classList.remove('bg-green-600');
                startButton.classList.add('bg-red-600');
            });
        };

        // Escuchar el click del usuario para iniciar
        startButton.addEventListener('click', initArJs);
    </script>
</body>
</html>
